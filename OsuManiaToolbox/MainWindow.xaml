<Window x:Class="OsuManiaToolbox.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:OsuManiaToolbox"
        xmlns:settings="clr-namespace:OsuManiaToolbox.Settings"
        xmlns:infra="clr-namespace:OsuManiaToolbox.Infrastructure"
        mc:Ignorable="d"
        d:DataContext="{d:DesignInstance Type=local:MainWindow, IsDesignTimeCreatable=True}"
        Height="500" Width="800">
  <Grid>
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="4*"/>
      <ColumnDefinition Width="Auto"/>
      <ColumnDefinition Width="5*"/>
    </Grid.ColumnDefinitions>
    <StackPanel Orientation="Vertical">
      <DockPanel>
        <TextBlock Text="osu路径"/>
        <TextBox Text="{Binding Settings.OsuPath}"/>
      </DockPanel>
      <Separator />
      <DockPanel>
        <TextBlock Text="写入DB时备份"/>
        <CheckBox IsChecked="{Binding Settings.BackupDb}"/>
        <TextBlock Text="日志等级"/>
        <ComboBox ItemsSource="{x:Static settings:CommonSettings.LogLevels}" 
                  SelectedItem="{Binding Settings.LogLevel}">
          <ComboBox.ItemTemplate>
            <DataTemplate>
              <TextBlock Text="{Binding Converter={StaticResource EnumToStringConverter}}"/>
            </DataTemplate>
          </ComboBox.ItemTemplate>
        </ComboBox>
      </DockPanel>
      <Border />
      <TextBlock>
        <Run Text="自定义成绩评级规则，方便按成绩找谱(默认的放眼看去全是"/>
        <Run Text="S" Foreground="Goldenrod" FontWeight="Bold"/>
        <Run Text=")"/>
      </TextBlock>
      <Separator />
      <ItemsControl ItemsSource="{Binding Regrade.Settings.GradeThresholds}">
        <ItemsControl.ItemsPanel>
          <ItemsPanelTemplate>
            <UniformGrid Rows="1"/>
          </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
        <ItemsControl.ItemTemplate>
          <DataTemplate>
            <DockPanel>
              <TextBlock Text="{Binding Grade}"/>
              <TextBox Text="{Binding Acc}" MinWidth="30" />
            </DockPanel>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>
      <Separator />
      <TextBlock>
        <Run Text="只有以下模式的成绩，打不动原速的谱给个"/>
        <Run Text="D" Foreground="DeepPink" FontWeight="Bold"/>
        <Run Text="一目了然"/>
      </TextBlock>
      <ItemsControl ItemsSource="{Binding Regrade.Settings.ModGradeStrategyIndexes}">
        <ItemsControl.ItemsPanel>
          <ItemsPanelTemplate>
            <UniformGrid Rows="1" />
          </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
        <ItemsControl.ItemTemplate>
          <DataTemplate>
            <DockPanel>
              <TextBlock Text="{Binding ModAcronym}"/>
              <ComboBox ItemsSource="{x:Static settings:RegradeSettings.AvailableStrategies}" DisplayMemberPath="Name"
                  SelectedIndex="{Binding Index}"/>
            </DockPanel>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>
      <Button Content="重新评级" Command="{Binding Regrade.RegradeCommand}"/>
      <Border />
      <TextBlock Text="替换SR为sunnyxxy SR，包括HT/DT，方便按难度排序选谱。但不包括EZ/HR，可以选个EZ看原始SR。"
                 TextWrapping="Wrap"/>
      <Separator />
      <StackPanel Orientation="Horizontal">
        <TextBlock Text="强制重算"/>
        <CheckBox IsChecked="{Binding StarRating.Settings.ForceUpdate}"/>
        <TextBlock Text="默认已经更新为XXY SR的直接跳过"/>
      </StackPanel>
      <UniformGrid Rows="1">
        <Button Content="重新计算(几分钟)" Command="{Binding StarRating.RunCommand}"/>
        <Button Content="取消" Command="{Binding StarRating.CancelCommand}"/>
      </UniformGrid>
      <Border />
      <DockPanel>
        <TextBlock Text="谱面筛选，过滤器无视大小写。字段说明见右侧Tab"/>
      </DockPanel>
      <Separator/>
      <DockPanel>
        <TextBlock Text="过滤条件" VerticalAlignment="Center"/>
        <Button Content="删除" DockPanel.Dock="Right" Command="{Binding Filter.DeleteItem}"/>
        <Button Content="新建" DockPanel.Dock="Right" Command="{Binding Filter.CreateItem}"/>
        <ComboBox ItemsSource="{Binding Filter.Settings.History}" 
                  SelectedItem="{Binding Filter.Selected}"
                  DisplayMemberPath="Expression"
                  Name="filterComboBox"
                  IsEditable="True"
                  IsTextSearchEnabled="False"
                  Text="{Binding Filter.Selected.Expression, UpdateSourceTrigger=PropertyChanged}"/>
      </DockPanel>
      <Separator/>
      <DockPanel>
        <TextBlock Text="收藏夹名称"/>
        <Button Content="生成收藏夹" DockPanel.Dock="Right" Command="{Binding Filter.CreateCollection}"/>
        <TextBox Text="{Binding Filter.Selected.CollectionName}" MinWidth="200"/>
      </DockPanel>
      <Separator/>
      <DockPanel>
        <TextBlock Text="输出到CSV"/>
        <Button Content="写入文件" DockPanel.Dock="Right" Command="{Binding Filter.WriteCsv}"/>
        <TextBlock Text=".csv" DockPanel.Dock="Right"/>
        <TextBox Text="{Binding Filter.Selected.CsvName}" MinWidth="200"/>
      </DockPanel>
      <Border />
      <TextBlock>
        <Run Text="项目地址"/>
        <Hyperlink NavigateUri="https://github.com/zzzzv/OsuManiaToolbox">
          https://github.com/zzzzv/OsuManiaToolbox
        </Hyperlink>
        <LineBreak/>
      </TextBlock>
    </StackPanel>
    <GridSplitter Grid.Column="1" 
                  Width="3" 
                  VerticalAlignment="Stretch" 
                  HorizontalAlignment="Center" 
                  Background="Gray"/>
    <TabControl Grid.Column="2" Name="tabRight">
      <TabItem Header="日志">
        <RichTextBox Name="logTextBox" IsReadOnly="True" VerticalScrollBarVisibility="Auto">
          <RichTextBox.Resources>
            <Style TargetType="{x:Type Paragraph}">
              <Setter Property="Margin" Value="0"/>
            </Style>
          </RichTextBox.Resources>
        </RichTextBox>
      </TabItem>
      <TabItem Header="过滤器说明">
        <ScrollViewer>
          <StackPanel>
            <DataGrid ItemsSource="{x:Static infra:FilterContext.DescriptionTable}"
                    AutoGenerateColumns="True"
                    IsReadOnly="True"
                    CanUserResizeColumns="False"
                    CanUserResizeRows="False"
                    GridLinesVisibility="Horizontal">
              <DataGrid.HorizontalGridLinesBrush>
                <SolidColorBrush Color="{DynamicResource {x:Static SystemColors.ActiveBorderColorKey}}"/>
              </DataGrid.HorizontalGridLinesBrush>
            </DataGrid>
            <Expander Header="DbBeatmap字段">
              <TextBlock Text="{x:Static infra:FilterContext.DbBeatmapDescription}" TextWrapping="Wrap"/>
            </Expander>
            <Expander Header="Score字段">
              <TextBlock Text="{x:Static infra:FilterContext.ScoreDescription}" TextWrapping="Wrap"/>
            </Expander>
          </StackPanel>
        </ScrollViewer>
      </TabItem>
    </TabControl>
  </Grid>
</Window>
